#!/usr/bin/env node
/**
 * Generate valid Prover.toml test data for the x402_zk_session circuit.
 * Uses the crypto package to compute matching Pedersen commitments.
 */

import { pedersenCommit, initPedersen } from '@demo/crypto';

// Test values
const nullifierSeed = 12345n;
const blindingFactor = 67890n;

// Service/context values
const serviceId = 1n;
const currentTime = BigInt(Math.floor(Date.now() / 1000));
const originId = 12345n;

// Issuer keys (placeholder - signature not verified yet)
const issuerPubkeyX = 1n;
const issuerPubkeyY = 2n;

// Credential values
const credTier = 1n;
const credMaxPresentations = 1000n;
const credIssuedAt = currentTime - 1000n;  // Issued 1000s ago
const credExpiresAt = currentTime + 86400n; // Expires in 1 day

// Presentation context
const presentationIndex = 0n;

async function main() {
  await initPedersen();

  // Compute the Pedersen commitment that matches the circuit
  const commitment = await pedersenCommit(nullifierSeed, blindingFactor);

  console.log(`# Generated by generate-test-data.mjs at ${new Date().toISOString()}`);
  console.log('');
  console.log('# Public inputs');
  console.log(`service_id = "${serviceId}"`);
  console.log(`current_time = "${currentTime}"`);
  console.log(`origin_id = "${originId}"`);
  console.log(`issuer_pubkey_x = "${issuerPubkeyX}"`);
  console.log(`issuer_pubkey_y = "${issuerPubkeyY}"`);
  console.log('');
  console.log('# Private inputs: Credential');
  console.log(`cred_service_id = "${serviceId}"`);
  console.log(`cred_tier = "${credTier}"`);
  console.log(`cred_max_presentations = "${credMaxPresentations}"`);
  console.log(`cred_issued_at = "${credIssuedAt}"`);
  console.log(`cred_expires_at = "${credExpiresAt}"`);
  console.log(`cred_commitment_x = "${commitment.x}"`);
  console.log(`cred_commitment_y = "${commitment.y}"`);
  console.log('');
  console.log('# Private inputs: Signature (placeholder - not verified yet)');
  console.log(`sig_r_x = "0"`);
  console.log(`sig_r_y = "0"`);
  console.log(`sig_s = "0"`);
  console.log('');
  console.log('# Private inputs: User secrets');
  console.log(`nullifier_seed = "${nullifierSeed}"`);
  console.log(`blinding_factor = "${blindingFactor}"`);
  console.log('');
  console.log('# Private inputs: Presentation context');
  console.log(`presentation_index = "${presentationIndex}"`);
}

main().catch(console.error);
